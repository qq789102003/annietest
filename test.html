<html>
<!-- å¼•å…¥ jQuery èˆ‡ Select2 -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>é›»ç¹¡ä¼°åƒ¹å–®</title>
  <script src="jquery-3.6.3.min.js"></script>
  
 <style>
		table {
			border-collapse: collapse;
			border: 2px solid black;
		}
		td {
			border: 2px solid black;
			padding: 10px;
		}
		tr {
			border: 2px solid black;
			padding: 10px;
		}
		th {
			border: 2px solid black;
			padding: 10px;
		}
</style>		
  
</head>

<body>
<div class="mode">
	<label><strong>1. æµç¨‹èªªæ˜:</strong></label>

</div>
<br /><br />


<!--æ¯ä»¶ç¹¡ä¸ä¸€æ¨£-->
<div class="fill2" style="display:block">
<label><strong>2. å¡«å¯«éœ€æ±‚åŠå…§å®¹:</strong></label><br /><br />
è¨‚å–®è™Ÿ: <input placeholder="M12345 or #20250101123456 å°šæœªæœ‰è¨‚å–®è™Ÿå¯å…å¡«" size="50"><br /><br />

<form id="orderForm">
<table class="table2" border="0">
    <thead>
    <tr>
	    <th>åºè™Ÿ</th>
		<th>å•†å“è²¨è™Ÿ</th>
		<th>é¡è‰²</th>
		<th>è¢–é•·</th>
        <th>å°ºå¯¸</th>
        <th>ä»¶æ•¸</th>
		<th>é›»ç¹¡ä½ç½®</th>
		<th>é›»ç¹¡å­—é«”</th>
		<th>é›»ç¹¡é¡è‰²</th>
		<th>é›»ç¹¡å…§å®¹(ç¬¬ä¸€è¡Œ)</th>
		<th>é›»ç¹¡å…§å®¹(ç¬¬äºŒè¡Œ)</th>
    </tr>
    </thead>
    <tbody>
    <tr id="clo2">
        <td class="td2">1</td>
		<td>
			<select id="product-code" name="product_code[]" class="s_product-code" style="width:100px">
				<option value="">è«‹é¸æ“‡</option>
				<option value="A148">A148</option>
				<option value="A204">A204</option>
				<option value="A222">A222</option>
				<option value="A246">A246</option>
				<option value="A248">A248</option>
				<option value="A302">A302</option>
				<option value="A305">A305</option>
				<option value="A502">A502</option>
				<option value="A505">A505</option>
				<option value="AB251">AB251</option>
				<option value="AB252">AB252</option>
				<option value="AB719">AB719</option>
				<option value="AC719">AC719</option>
				<option value="AS136">AS136</option>
				<option value="AS150">AS150</option>
				<option value="AS250">AS250</option>
				<option value="AS251">AS251</option>
				<option value="AS716">AS716</option>
				<option value="AS7161">AS7161</option>
				<option value="AS717">AS717</option>
				<option value="AS718">AS718</option>
				<option value="AS7181">AS7181</option>
				<option value="AS804">AS804</option>
				<option value="B101">B101</option>
				<option value="B108">B108</option>
				<option value="B110">B110</option>
				<option value="B111">B111</option>
				<option value="B122">B122</option>
				<option value="B133">B133</option>
				<option value="B201">B201</option>
				<option value="B202">B202</option>
				<option value="B204">B204</option>
				<option value="B208">B208</option>
				<option value="B210">B210</option>
				<option value="B211">B211</option>
				<option value="B222">B222</option>
				<option value="B233">B233</option>
				<option value="B235">B235</option>
				<option value="B241">B241</option>
				<option value="B302">B302</option>
				<option value="B304">B304</option>
				<option value="B305">B305</option>
				<option value="B502">B502</option>
				<option value="B505">B505</option>
				<option value="B603">B603</option>
				<option value="B608">B608</option>
				<option value="B801">B801</option>
				<option value="B802">B802</option>
				<option value="C302">C302</option>
				<option value="C303">C303</option>
				<option value="C304">C304</option>
				<option value="C503">C503</option>
				<option value="C605">C605</option>
				<option value="C605A">C605A</option>
				<option value="C7021">C7021</option>
				<option value="C709">C709</option>
				<option value="C7091">C7091</option>
				<option value="C713">C713</option>
				<option value="C714">C714</option>
				<option value="C805N1">C805N1</option>
				<option value="D303">D303</option>
				<option value="D305">D305</option>
				<option value="D503">D503</option>
				<option value="F603">F603</option>
				<option value="F6041">F6041</option>
				<option value="F605">F605</option>
				<option value="F605A">F605A</option>
				<option value="F608">F608</option>
				<option value="F609">F609</option>
				<option value="F611">F611</option>
				<option value="I245">I245</option>
				<option value="I704">I704</option>
				<option value="I712">I712</option>
				<option value="W403">W403</option>
				<option value="W4031">W4031</option>
				<option value="W460">W460</option>
			  </select>
		</td>

<script>
  $(document).ready(function() {
    $('#product-code').select({
      placeholder: "è«‹é¸æ“‡æˆ–è¼¸å…¥è²¨è™Ÿ",
      allowClear: true
    });
  });
</script>

		<td>
		  <select class="s_color" name="s_color[]">
			<option value="">è«‹é¸æ“‡</option>
			<option value="A0å¯¶å¯¶ç²‰">A0 å¯¶å¯¶ç²‰</option>
			<option value="A1æ´»æ½‘ç²‰">A1 æ´»æ½‘ç²‰</option>
			<option value="A2æ¢…å­ç²‰">A2 æ¢…å­ç²‰</option>
			<option value="A3çŠç‘šç²‰">A3 çŠç‘šç²‰</option>
			<option value="A6äº®æ¡ƒç´…">A6 äº®æ¡ƒç´…</option>
			<option value="A9é‡€é…’ç´…">A9 é‡€é…’ç´…</option>
			<option value="B0å¯¶å¯¶è—">B0 å¯¶å¯¶è—</option>
			<option value="B5åŒ—æ­è—">B5 åŒ—æ­è—</option>
			<option value="B7è”šæµ·è—">B7 è”šæµ·è—</option>
			<option value="B7å¯¶çŸ³è—">B7 å¯¶çŸ³è—</option>
			<option value="B9æ·±æµ·è—">B9 æ·±æµ·è—</option>
			<option value="C0ä¸é¦™ç´«">C0 ä¸é¦™ç´«</option>
			<option value="C2è¿·éœ§ç´«">C2 è¿·éœ§ç´«</option>
			<option value="C6äº®ç´«ç´…">C6 äº®ç´«ç´…</option>
			<option value="C7è‘¡è„ç´«">C7 è‘¡è„ç´«</option>
			<option value="D0å¤©å ‚è—">D0 å¤©å ‚è—</option>
			<option value="E0æœå­ç¶ ">E0 æœå­ç¶ </option>
			<option value="E2é›ªæ¾ç¶ ">E2 é›ªæ¾ç¶ </option>
			<option value="E5æŠ¹èŒ¶ç¶ ">E5 æŠ¹èŒ¶ç¶ </option>
			<option value="F0ç²‰éœ§æ©˜">F0 ç²‰éœ§æ©˜</option>
			<option value="F1å¡å…¶ç°">F1 å¡å…¶ç°</option>
			<option value="F1æä»å¥¶">F1 æä»å¥¶</option>
			<option value="F5è±†æ²™ç´…">F5 è±†æ²™ç´…</option>
			<option value="F7æš—æ£—ç´…">F7 æš—æ£—ç´…</option>
			<option value="F8ç¤¦ç‰©æ£•">F8 ç¤¦ç‰©æ£•</option>
			<option value="W0ç´”ç²¹ç™½">W0 ç´”ç²¹ç™½</option>
			<option value="W3è“‹äºç°">W3 è“‹äºç°</option>
			<option value="W6ç°è’¼è—">W6 ç°è’¼è—</option>
			<option value="W7æš—å²©ç°">W7 æš—å²©ç°</option>
			<option value="W8å¤œå¹•é»‘">W8 å¤œå¹•é»‘</option>
			<option value="W9çŸ³å¢¨é»‘">W9 çŸ³å¢¨é»‘</option>
		  </select>
		</td>
        <td> <select class="s_sleeve" name="s_sleeve[]"> <!-- è¢–é•· -->
			    <option>è«‹é¸æ“‡</option>
				<option value="short">çŸ­è¢–</option>
				<option value="long">é•·è¢–</option>
				<option value="three_quarter">ä¸ƒåˆ†è¢–</option>
		     </select>
		</td>
		<td>
		  <select class="s_size" name="s_size[]">
			<option value="">è«‹é¸æ“‡</option>
			<option value="æ•´æ‰¹ç¹¡ä¸€æ¨£">æ•´æ‰¹ç¹¡ä¸€æ¨£</option>
			<option value="XS">XS</option>
			<option value="S">S</option>
			<option value="M">M</option>
			<option value="L">L</option>
			<option value="XL">XL</option>
			<option value="2XL">2XL</option>
			<option value="3XL">3XL</option>
			<option value="4XL">4XL</option>
			<option value="5XL">5XL</option>
			<option value="6XL">6XL</option>
			<option value="7XL">7XL</option>
			<option value="8XL">8XL</option>
		  </select>
		</td>
		<td> <input name="i_number[]" placeholder="" size="10" /></td> <!-- ä»¶æ•¸ -->
		<td> <select class="s_position" name="s_position[]"> <!-- é›»ç¹¡ä½ç½® -->
			    <option>è«‹é¸æ“‡</option>
				<option value="left_chest">å·¦èƒ¸å£è™•</option>
				<option value="right_chest">å³èƒ¸å£è™•</option>
				<option value="above_left_pocket">å·¦èƒ¸å£è¢‹ä¸Šæ–¹</option>
				<option value="above_right_pocket">å³èƒ¸å£è¢‹ä¸Šæ–¹</option>
		     </select>
		</td>
		<td> <select class="s_font" name="s_font[]"> <!-- é›»ç¹¡å­—é«” -->
			    <option>è«‹é¸æ“‡</option>
				<option value="ch_kai">ä¸­æ–‡-æ¨™æ¥·é«”</option>
				<option value="ch_heavy">ä¸­æ–‡-è¯åº·ä¸­é»‘é«”</option>
				<option value="en_kai">è‹±æ–‡-æ¨™æ¥·é«”</option>
				<option value="en_arial">è‹±æ–‡-Arial</option>
				<option value="en_brush_script_mt">è‹±æ–‡-Brush Script MT</option>
				<option value="en_kunstler_script">è‹±æ–‡-Kunstler Script</option>
		     </select>
		</td>
		<td> <select class="s_embroidery_color" name="s_embroidery_color[]"> <!-- é›»ç¹¡é¡è‰² -->
			    <option>è«‹é¸æ“‡</option>
				<option value="700_apple_red">700 è˜‹æœç´…</option>
				<option value="535_orange_red">535 æ©˜ç´…è‰²</option>
				<option value="525_golden_yellow">525 é‡‘é»ƒè‰²</option>
				<option value="233_apple_green">233 é’è˜‹ç¶ </option>
				<option value="323_teal">323 è—ç¶ è‰²</option>
				<option value="367_royal_blue">367 å¯¶è—è‰²</option>
				<option value="335_navy">335 ä¸ˆé’è‰²</option>
				<option value="676_dark_purple">676 æ·±ç´«è‰²</option>
				<option value="745_bronze">745 å¤éŠ…è‰²</option>
				<option value="900_black">900 æ™‚å°šé»‘</option>
				<option value="800_white">800 å¤©ä½¿ç™½</option>
				<option value="483_silver_gray">483 éŠ€ç°è‰²</option>
		     </select>
		</td>
		<!-- é›»ç¹¡å…§å®¹1 maxlengthå­—æ•¸é™åˆ¶-->

			<td><input id="embroidery1" name="i_embroidery1[]" placeholder="å­—æ•¸é™åˆ¶ï¼Œè¶…éè‡ªå‹•åˆªé™¤"/></td>
			<td><input id="embroidery2" name="i_embroidery2[]" placeholder="å­—æ•¸é™åˆ¶ï¼Œè¶…éè‡ªå‹•åˆªé™¤"/></td>

			<script>
			  const maxLength = 5; // è‡ªè¨‚é™åˆ¶

			  function getLength(str) {
				let len = 0;
				for (let char of str) {
				  if (char.charCodeAt(0) > 255) {
					len += 1;   // ä¸­æ–‡ã€å…¨å½¢
				  } else {
					len += 0.5; // è‹±æ–‡ã€åŠå½¢
				  }
				}
				return len;
			  }

			  function trimToMax(str) {
				while (getLength(str) > maxLength) {
				  str = str.slice(0, -1);
				}
				return str;
			  }

			  function applyLimit(inputId) {
				const input = document.getElementById(inputId);
				input.addEventListener("blur", function () {
				  input.value = trimToMax(input.value);
				});
			  }

			  // å¥—ç”¨åˆ°å…©å€‹æ¬„ä½
			  applyLimit("embroidery1");
			  applyLimit("embroidery2");
			</script>
		
    </tr>
    </tbody>
</table>

<!-- éš±è—æ¬„ä½ï¼Œç”¨ä¾†æ”¾çµ„å¥½çš„ HTML è¡¨æ ¼çµ¦ EmailJS -->
<input type="hidden" name="table_content" id="table_content">
<input type="hidden" name="user_name" id="user_name">
<input type="hidden" name="user_email" id="user_email">

<br />
<button type="button" onclick="fun('table2','clo2','td2')">æ–°å¢ä¸€è¡Œ</button>
&nbsp;<button type="button" onclick="fun_same('table2','clo2','td2')">è¤‡è£½æœ€å¾Œä¸€è¡Œ</button>
&nbsp;<button type="button" onclick="del('table2')">åˆªé™¤æœ€å¾Œä¸€è¡Œ</button>

<br />
<br />
</div>
<!--
<div class="fill3" style="display:none">
<label><strong>ç¹¡å­—å…§å®¹:</strong></label>
<br />
&nbsp;&nbsp;é›»ç¹¡å…§å®¹(ç¬¬ä¸€è¡Œ): <input name="myfield3" value="æ„›ç†é†«é™¢1" size="50">
&nbsp;&nbsp;é›»ç¹¡å…§å®¹(ç¬¬äºŒè¡Œ): <input name="myfield4" value="æ„›ç†é†«é™¢2" size="50">
<br />
</div>
-->
<div class="fill4" style="display:block">
<br />
<label><strong>3. è¯çµ¡æ–¹å¼</strong></label>
<br /><br />
&nbsp;&nbsp;&nbsp;&nbsp;å–®ä½åç¨±: <input name="myname" size="30"> <br /><br />
&nbsp;&nbsp;&nbsp;&nbsp;è¯çµ¡äººå§“å: <input name="myname" size="30"> <br /><br />
&nbsp;&nbsp;&nbsp;&nbsp;é›»è©±: <input name="myphone" size="30"> <br /><br />
&nbsp;&nbsp;&nbsp;&nbsp;e-mail: <input name="myemail" size="50"> <br />
</div>
</body>

<div class="price" style="display:block">
<br />
<label id="final_id" style="color:red;"></label>
 <button type="button" id="copyButton" style="display:none">è¤‡è£½å–®è™Ÿ</button>
<br />
<label id="final_price" style="color:red;"></label>
<br />
</div>

<div class="note">
    <br />
    <label><strong>4.</strong></label>
    <br />
    <label style="color: red;"><strong>åªè¨ˆç®—é‡‘é¡è«‹é¸ã€Œä¼°åƒ¹ã€</strong></label>
    <br />
    <label style="color: red;"><strong>é€å‡ºè¨‚å–®è«‹é¸ã€Œä¼°åƒ¹ä¸¦é€å–®ã€</strong></label>
    <br />
    <label style="color: red;"><strong>è«‹æ³¨æ„ï¼Œé¸æ“‡ã€Œä¼°åƒ¹ä¸¦é€å–®ã€æ„›ç†æ‰æœƒæ”¶åˆ°æ‚¨çš„è¨‚å–®å”·</strong></label>
    <br />
    <br />
    <label style="color: blue;"><strong>â˜†</strong></label>
	<br />
	<label style="color: blue;"><strong>ä¸­æ–‡ 1 å­—ï¼š30å…ƒ</strong></label>
	<br />
	<label style="color: blue;"><strong>è‹±æ–‡ 1 å­—ï¼š15å…ƒ</strong></label>
	<br />
	<label style="color: blue;"><strong>æ•¸å­— 1 å­—ï¼š15å…ƒ</strong></label>
	<br />
	<label style="color: blue;"><strong>ç¬¦è™Ÿ 1 å­—ï¼š15å…ƒ</strong></label>
	<br />
	<label style="color: blue;"><strong>ç©ºã€€æ ¼ï¼šä¸ç®—è²»ç”¨</strong></label>
</div>


<div class="botton1" style="display:block">
<br />
<button type="button" id="nosave">ä¼°åƒ¹</button>
<button type="submit" id="save">ä¼°åƒ¹ä¸¦é€å–®</button>
</div>
</form>


<script>

var final_id = "";
var i = 1;
var total_price = 0;


$(".td").each(function(){
	$(this).html(i++);
})

function fun_same(ta, col, v) {
    var $table = $("." + ta);
    var $lastRow = $table.find("tr:last");
    var $clonedLastRow = $lastRow.clone();

    // è¦è¤‡è£½çš„ select class åˆ—è¡¨
    var fieldsToCopy = [
	    "s_product-code",
		"s_color",
        "s_sleeve",
		"s_size",
        "s_position",
        "s_font",
        "s_embroidery_color"
    ];

    // è¤‡è£½æ¯å€‹æ¬„ä½çš„å€¼
    fieldsToCopy.forEach(function(className) {
        var originalVal = $lastRow.find("." + className).val();
        $clonedLastRow.find("." + className).val(originalVal);
    });

    // åŠ å…¥è¤‡è£½è¡Œ
    $table.append($clonedLastRow);

    // æ›´æ–°åºè™Ÿ
    var i = 1;
    $("." + v).each(function () {
        $(this).html(i++);
    });
}

function fun(ta,col,v){
	var $td = $("#"+col).clone();       //å¢åŠ ä¸€è¡Œ,å…‹éš†ç¬¬ä¸€å€‹å°è±¡
	$("."+ta).append($td);
	var i = 1;
	$("."+v).each(function(){       //å¢åŠ ä¸€è¡Œå¾Œé‡æ–°æ›´æ–°åºè™Ÿ1,2,3......
	$(this).html(i++);
	})
	$("."+ta+" tr:last").find(":input").val('');   //å°‡å°¾è¡Œå…ƒç´ å…‹éš†ä¾†çš„ä¿å­˜çš„å€¼æ¸…ç©º
}

function del(ta){
	$("."+ta+" tr:not(:first):not(:first):last").remove();//ç§»é™¤æœ€å¾Œä¸€è¡Œ,ä¸¦ä¸”ä¿ç•™å‰å…©è¡Œ
}

function sum_money(myfield) {
		var pattern = new RegExp("[\u4E00-\u9FA5]+") //åˆ¤æ–·ä¸­æ–‡
		
		var c_chinese_20 = 0;
		var c_other_10 = 0;
		var c_space = 0;
		for (let i = 0; i < myfield.length; i++) {
			if (pattern.test(myfield[i])) {
			    //alert(myfield[i])
				c_chinese_20++;
			} else {
			    //alert("ä¸æ˜¯ä¸­æ–‡:"+myfield[i])
				if (myfield[i] != " " && myfield[i] != "ã€€")
				    c_other_10++;
			    else
				    c_space++;
		    }
		}
		
		var price_all = (c_chinese_20 * 30) + (c_other_10 * 15);
		
		return {chinese:c_chinese_20, other:c_other_10, space:c_space, price:price_all};
}

function final_cal() {
    //reset
	$('#final_id').text("");
	$('#copyButton').css("display", "none");
	$('#final_price').text("");
	$(".price").css("display", "none");
	final_id = "";
	total_price = 0;

	var table_v = "";
	var obj1;
	var obj2;
//æ¯ä»¶ç¹¡ä¸ä¸€æ¨£
	table_v = "table2"

	$("."+table_v+" tr").each(function(i){
		if (i != 0) {
		   var myfield1 = $(this).find('td:eq(9)').find("input").val()
		   //alert("ç¬¬"+(i+1)+"è¡Œtdçš„å€¼ï¼š"+myfield1+"ã€‚");

		   var myfield2 = $(this).find('td:eq(10)').find("input").val()
		   //alert("ç¬¬"+(i+1)+"è¡Œtdçš„å€¼ï¼š"+myfield2+"ã€‚");
   
		   var col_number = $(this).find('td:eq(5)').find("input").val();
		   
		   if (col_number > 0) {
			   obj1 = sum_money(myfield1);
			   obj2 = sum_money(myfield2);				   
			   total_price += (parseInt(obj1.price) * parseInt(col_number));
			   total_price += (parseInt(obj2.price) * parseInt(col_number));
		   }
		   //alert("ä¸­æ–‡æ•¸é‡:"+obj1.chinese+" ,å…¶é¤˜å­—æ•¸é‡:"+obj1.other+" ,ç©ºç™½å­—æ•¸é‡:"+obj1.space+" ,å–®åƒ¹:"+obj1.price+" ,ç›®å‰ç¸½åƒ¹:"+total_price);
		   //alert("ä¸­æ–‡æ•¸é‡:"+obj2.chinese+" ,å…¶é¤˜å­—æ•¸é‡:"+obj2.other+" ,ç©ºç™½å­—æ•¸é‡:"+obj2.space+" ,å–®åƒ¹:"+obj2.price+" ,ç›®å‰ç¸½åƒ¹:"+total_price);
		}
	});
	
	if (total_price == 0) {
	    alert("æ¬„ä½å¡«å¯«æœ‰èª¤, è«‹é‡æ–°ç¢ºèª");
	    return 0;
	}
	/* //debug table
    $("."+table_v+" tr").each(function(i){
       $(this).children('td').each(function(j){
	       if (j == 0) {
		       alert("ç¬¬"+(i+1)+"è¡Œï¼Œç¬¬"+(j+1)+"ä¸ªtdçš„å€¼ï¼š"+$(this).text()+"ã€‚");
		   } else {
		       alert("ç¬¬"+(i+1)+"è¡Œï¼Œç¬¬"+(j+1)+"ä¸ªtdçš„å€¼ï¼š"+$(this).find("input").val()+"ã€‚");
		   }
       });
    });
	*/
	
	var json_arr = [];
	
	$("."+table_v+" tr").each(function(i){
		if (i != 0) {
		   var table_id = $(this).find('td:eq(0)').text(); //åºè™Ÿ
		   var table_item = $(this).find('td:eq(1)').find("select option:selected").text(); //è²¨è™Ÿ
		   var table_color = $(this).find('td:eq(2)').find("select option:selected").text() //é¡è‰²
		   var table_sleeve = $(this).find('td:eq(3)').find("select option:selected").text() //è¢–é•·
		   var table_size = $(this).find('td:eq(4)').find("select option:selected").text() //å°ºå¯¸
		   var table_number = $(this).find('td:eq(5)').find("input").val() //ä»¶æ•¸
		   var table_position = $(this).find('td:eq(6)').find("select option:selected").text() //é›»ç¹¡ä½ç½®
		   var table_font = $(this).find('td:eq(7)').find("select option:selected").text() //é›»ç¹¡å­—é«”
		   var table_fontcolor = $(this).find('td:eq(8)').find("select option:selected").text() //é›»ç¹¡é¡è‰²
		   var table_content1 = $(this).find('td:eq(9)').find("input").val() //é›»ç¹¡å…§å®¹(ç¬¬ä¸€è¡Œ)
		   var table_content2 = $(this).find('td:eq(10)').find("input").val() //é›»ç¹¡å…§å®¹(ç¬¬ä¸€è¡Œ)

		   if (table_item == "" || table_color == "" || parseInt(table_number) <= 0 || table_position == "" || table_font == "" || table_fontcolor == "") {
			   alert("æ¬„ä½å¡«å¯«æœ‰èª¤, è«‹é‡æ–°ç¢ºèª");
			   return 0;
		   }

		   json_arr.push({"id": table_id, "item":table_item, "color":table_color, "sleeve":table_sleeve, "size":table_size, "number":table_number, "position":table_position, "font":table_font, "font":table_fontcolor, "content1":table_content1, "content2":table_content2, "price":total_price})
		   alert(
			  "id: " + table_id +
			  "\nitem: " + table_item +
			  "\ncolor: " + table_color +
			  "\nsleeve: " + table_sleeve +
			  "\nsize: " + table_size +
			  "\nnumber: " + table_number +
			  "\nposition: " + table_position +
			  "\nfont: " + table_font +
			  "\nfontcolor: " + table_fontcolor +
			  "\ncontent1: " + table_content1 +
			  "\ncontent2: " + table_content2 +
			  "\nprice: " + total_price
            );
		}
	});
	return json_arr;
}
/*
$('#save').click(function(){
	var result = confirm("ç¢ºå®šè¼¸å…¥éƒ½æ­£ç¢ºä¸¦æº–å‚™é–‹å§‹ä¼°åƒ¹å­˜æª”å—?");
	if (result) {
		var final_json = final_cal();
		alert(final_json);

	}
});
*/
$('#nosave').click(function(){
    var final_json = final_cal();
	$(".price").css("display", "block");
	$('#final_price').text("ç¸½åƒ¹:" + total_price);
});

$('#copyButton').click(function() {
  var text = final_id;
  var $temp = $('<input>');
  $('body').append($temp);
  $temp.val(text).select();
  document.execCommand('copy');
  $temp.remove();
});

// å°‡è¡¨æ ¼ä¸­çš„æ‰€æœ‰ select èˆ‡ input çš„å€¼ï¼Œæ›æˆæ–‡å­—é¡¯ç¤º
function prepareTableForEmail(tableSelector) {
  const table = document.querySelector(tableSelector);
  const selects = table.querySelectorAll('select');
  selects.forEach(select => {
    const selectedText = select.options[select.selectedIndex]?.text || '';
    const td = select.closest('td');
    td.textContent = selectedText; // ç”¨æ–‡å­—å–ä»£æ•´å€‹ td çš„å…§å®¹
  });

  const inputs = table.querySelectorAll('input');
  inputs.forEach(input => {
    const value = input.value;
    const td = input.closest('td');
    td.textContent = value; // ç›´æ¥æŠŠå€¼æ”¾é€² td è£¡
  });
}

function styleTableForEmail(tableSelector) {
  const table = document.querySelector(tableSelector);
  table.setAttribute("border", "1");
  table.setAttribute("cellpadding", "8");
  table.style.borderCollapse = "collapse";
  table.style.width = "100%";

  const allCells = table.querySelectorAll("th, td");
  allCells.forEach(cell => {
    cell.style.border = "1px solid #000";
    cell.style.padding = "8px";
    cell.style.textAlign = "center";
    cell.style.fontSize = "14px";
  });
}

$(document).ready(function () {
    emailjs.init('68i7tkfMbfPaTCzuw'); // æ›æˆä½ çš„ Public Key
});

// è¡¨å–®é€å‡º
document.getElementById("orderForm").addEventListener("submit", function(e) {
    e.preventDefault();

    // ğŸ” æŠŠä½¿ç”¨è€…å¡«å…¥çš„è³‡æ–™è½‰ç‚ºéœæ…‹æ–‡å­—
    prepareTableForEmail(".table2");
	styleTableForEmail(".table2");     // æŠŠè¡¨æ ¼åŠ ä¸Šæ ¼ç·š & æ¨£å¼

	// å–å¾—éœæ…‹è¡¨æ ¼ HTML
	var tableHtml = document.querySelector(".table2").outerHTML;
	document.getElementById("table_content").value = tableHtml;
	
    document.getElementById("user_name").value = "ç„¡å¤©ç¥¥";
	document.getElementById("user_email").value = "ginger91325@gmail.com";

    // ç¢ºèªé€å‡º
    var result = confirm("ç¢ºå®šè¼¸å…¥éƒ½æ­£ç¢ºä¸¦æº–å‚™é–‹å§‹ä¼°åƒ¹å­˜æª”å—?");
    if(result){
		emailjs.sendForm('service_fy9ayzj', 'template_g0mopsa', this)
		  .then(function (response) {
			alert('âœ… å·²æˆåŠŸé€å‡ºä¿¡ä»¶ï¼');
			console.log('æˆåŠŸ', response);
		  }, function (error) {
			alert('âŒ ç™¼é€å¤±æ•—ï¼š' + JSON.stringify(error));
			console.error('éŒ¯èª¤', error);
		  });
    }
});

</script>

</html>
